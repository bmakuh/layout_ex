- content_for :title do
  Profile
-if @household.num_children > @household.children.count
  #profile_notice
    %h3 Your household is incomplete!
    You have indicated that you have #{@household.num_children} children, but you have only created #{pluralize(@household.children.count, "child")} for your household.
    %p=link_to "Add another child >>", new_members_child_path
#left-column
  #photo

    -#=link_to image_tag(@household.photo.url(:medium)) , edit_members_profile_path(@household)


    -#= link_to image_tag(@household.photo.url(:medium)) , members_profile_edit_path(@household)

    =link_to image_tag(@household.photo.url(:medium)) , members_profile_edit_path

  #info
    %div.title Caregiver(s)
    %div
      -for user in @household.users
        -unless @household.users.eql? nil
          -if user.household_confirmed.eql? true
            .child
              =h link_to "#{user.first_name} #{user.last_name}", members_user_path(user)
        -else
          You have no caregivers
      %p
    %div.title
      Children
      %span#small_link= link_to "(view all)", members_children_path
    %div
      -for child in @household.children
        -unless @household.children.eql? nil
          .child
            =h link_to "#{child.first_name} #{child.last_name}", members_child_path(child)
        -else
          You have no children.
      %p= link_to "Add Child", new_members_child_path
    %div.title
      = "Address"
      %span#small_link= link_to " (edit)", edit_members_address_path(@household.address)
    %div
      - unless @household.address.nil?
        = @household.address.street1
        = @household.address.street2
        %br
        = "#{@household.address.city}, "
        = @household.address.state
        = @household.address.zip

      - else
        You haven't entered an address for your household.
        %p
        = link_to "+ Add an address", new_members_address_path
      %p
    %div.title 
      Phone
      %span#small_link= link_to "(edit)", members_settings_path
    %div
      -for phone_number in @household.users
        -unless @household.users.eql? nil
          .child
            =h "#{number_to_phone(phone_number.phone)}"
        -else
          No known phone numbers

#right-column
  #top
    #household-info
      %h1= "The #{@household} Household"
      %br
      
      // open requests should look like they deduct immediately
      - open_requests_sum = 0
      -for request in @household.requests
        - unless commit(request)
          - open_requests_sum += 1
      
      = "Credit Balance: #{@household.credits - open_requests_sum}"
      %br
      -#= "confirmed Credits: #{@household.requests.cost}"
    #buttons
      = link_to 'Edit my Household', members_profile_edit_path
      = link_to '+ Create a New Request', new_members_request_path
  #content
    - openRequests = false
    - if @household.requests.length > 0
      - for r in @household.requests
        - if !commit(r)
          - openRequests = true
          - break
      - if !openRequests
        #no-requests 
          You have no open requests.
      - else
        %font.small-title My open requests
        #requests
          - for request in @household.requests
            -unless commit(request)
              .request

                .left
                  %h2#name= request.household
                  %h2#household Household
                .right
                  .title
                    =h request.title
                  .date
                    =h request.start_time.to_s(:nicetime)
                    to
                    =h request.end_time.to_s(:nicetime)
                    on
                    =h request.from_date.to_s(:short)
                    -if request.from_date != request.to_date
                      to
                      =h request.to_date.to_s(:short)
                  .cost
                    Cost:
                    =h request.cost
                    credits
                  .children
                    Children:
                    -@count = 0
                    -for child in request.children
                      -if request.children.count == 1
                        =h "#{child}"
                      -else
                        =h "#{child}, "
                      -@count +=1
                      -if @count != request.children.length
                        ,
                .tools
                  %span= link_to "Edit", edit_members_request_path(request)
                  %span= link_to "Cancel", members_request_path(request), :confirm => 'Are you sure?', :method => :delete
                .clear
    - else
      #no-requests
        You have no open requests.

    - if @confirmed_requests.length > 0
      %font.small-title Confirmed care requests
    - if @confirmed_requests.length == 0
      #no-requests
        You have no confirmed requests.
    - else
      #requests
        - for confirmed in @confirmed_requests
          .request
            
            .left
              %h2#name=confirmed.request.household
              %h2#household Household
            .right
              .date
                =h confirmed.request.start_time.to_s(:nicetime)
                to
                =h confirmed.request.end_time.to_s(:nicetime)
                on
                =h confirmed.request.from_date.to_s(:short)
                - if confirmed.request.from_date != confirmed.request.to_date
                  to
                  =h confirmed.request.to_date.to_s(:short)
                .cost
                  Cost:
                  =h confirmed.request.cost
                  credits
                .children
                  Children
                  -@count = 0
                  -for child in confirmed.request.children
                    -if confirmed.request.children.count == 1 or child.eql? commitment.request.children.last
                      =h "#{child}"
                    -else
                      =h "#{child}, "
                    -@count += 1
                    -if @count != confirmed.request.children.length
                      ,
            .tools
              %span= link_to "Edit", edit_members_request_path(confirmed.request)
              %span= link_to "Cancel", members_request_path(confirmed.request), :confirm => 'Are you sure?', :method => :delete
            .clear

    - if @commitments.length > 0
      %font.small-title My commitments
    - if @commitments.length == 0
      #no-requests
        You have no commitments.
    - else
      #requests
        - for commitment in @commitments
          .request
            .img 
              =image_tag(commitment.request.household.photo.url(:thumb), :alt => "#{commitment.household.to_s}")
            .left
              %h2#name=commitment.request.household
              %h2#household Household
            .right
              .date
                =h commitment.request.start_time.to_s(:nicetime)
                to
                =h commitment.request.end_time.to_s(:nicetime)
                on
                =h commitment.request.from_date.to_s(:short)
                - if commitment.request.from_date != commitment.request.to_date
                  to
                  =h commitment.request.to_date.to_s(:short)
                .cost
                  Cost:
                  =h commitment.request.cost
                  credits
                .children
                  Children
                  -@count = 0
                  -for child in commitment.request.children or child.eql? commitment.request.children.last
                    =h "#{child}"
                    -@count += 1
                    -if @count != commitment.request.children.length
                      ,
            .tools
              %span= link_to "Show Details", detail_members_request_path(commitment.request)
            .clear

